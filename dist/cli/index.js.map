{"version":3,"sources":["../../src/cli/index.ts","../../src/cli/commands/init.ts","../../src/index.ts"],"sourcesContent":["import { program } from 'commander';\nimport { spawn } from 'child_process';\nimport pc from 'picocolors';\nimport { init } from './commands/init.js';\nimport { VERSION } from '../index.js';\n\nprogram\n  .name('tkhrn-ruler')\n  .description('Frontend common ruleset CLI for AI agents')\n  .version(VERSION);\n\n// Custom init command\nprogram\n  .command('init')\n  .description('Initialize tkhrn-ruler in current project')\n  .option('-i, --interactive', 'Interactive mode for selecting options')\n  .option('--skip-env', 'Skip .env.mcp.example setup')\n  .option('--skip-gitignore', 'Skip .gitignore modification')\n  .action(init);\n\n// Passthrough all other commands to ruler\nprogram\n  .command('apply', { isDefault: false })\n  .description('Apply rules to configured agents (passthrough to ruler)')\n  .allowUnknownOption(true)\n  .action(() => passthrough('apply'));\n\nprogram\n  .command('revert')\n  .description('Revert applied rules (passthrough to ruler)')\n  .allowUnknownOption(true)\n  .action(() => passthrough('revert'));\n\n// Catch-all for any other ruler commands\nprogram\n  .arguments('<command> [args...]')\n  .allowUnknownOption(true)\n  .action((command: string) => passthrough(command));\n\nfunction passthrough(command: string) {\n  const args = process.argv.slice(process.argv.indexOf(command));\n\n  console.log(pc.dim(`‚Üí ruler ${args.join(' ')}`));\n\n  const child = spawn('ruler', args, {\n    stdio: 'inherit',\n    shell: true,\n  });\n\n  child.on('error', (err) => {\n    if ((err as NodeJS.ErrnoException).code === 'ENOENT') {\n      console.error(pc.red('\\nError: ruler is not installed.'));\n      console.error(pc.dim('Install it with: npm install -g @intellectronica/ruler'));\n      process.exit(1);\n    }\n    console.error(pc.red(`Error: ${err.message}`));\n    process.exit(1);\n  });\n\n  child.on('close', (code) => {\n    process.exit(code ?? 0);\n  });\n}\n\nprogram.parse();\n","import { spawn } from 'child_process';\nimport { existsSync, appendFileSync, readFileSync, writeFileSync } from 'fs';\nimport { join } from 'path';\nimport pc from 'picocolors';\nimport { REPO } from '../../index.js';\n\ninterface InitOptions {\n  interactive?: boolean;\n  skipEnv?: boolean;\n  skipGitignore?: boolean;\n}\n\nexport async function init(options: InitOptions) {\n  const cwd = process.cwd();\n\n  console.log(pc.bold('\\nüöÄ Initializing tkhrn-ruler...\\n'));\n\n  // Check if .ruler already exists\n  if (existsSync(join(cwd, '.ruler'))) {\n    console.log(pc.yellow('‚ö†Ô∏è  .ruler directory already exists.'));\n    console.log(pc.dim('   Use \"tkhrn-ruler apply\" to apply rules.\\n'));\n    return;\n  }\n\n  // Step 1: Download .ruler directory using degit\n  console.log(pc.dim('‚Üí Downloading ruleset...'));\n\n  try {\n    await runCommand('npx', ['degit', `${REPO}/.ruler`, '.ruler']);\n    console.log(pc.green('‚úì .ruler directory created'));\n  } catch (error) {\n    console.error(pc.red('‚úó Failed to download ruleset'));\n    process.exit(1);\n  }\n\n  // Step 2: Download .env.mcp.example\n  if (!options.skipEnv) {\n    console.log(pc.dim('‚Üí Downloading MCP environment template...'));\n\n    try {\n      await runCommand('npx', ['degit', `${REPO}/.env.mcp.example`, '.env.mcp.example', '--force']);\n      console.log(pc.green('‚úì .env.mcp.example created'));\n    } catch {\n      // If degit fails for single file, create it manually\n      console.log(pc.yellow('‚ö†Ô∏è  Could not download .env.mcp.example, creating empty template'));\n      await createEnvTemplate(cwd);\n    }\n  }\n\n  // Step 3: Update .gitignore\n  if (!options.skipGitignore) {\n    updateGitignore(cwd);\n  }\n\n  // Step 4: Run ruler init if ruler is installed\n  console.log(pc.dim('‚Üí Running ruler init...'));\n\n  try {\n    await runCommand('ruler', ['init'], { silent: true });\n    console.log(pc.green('‚úì Ruler initialized'));\n  } catch {\n    console.log(pc.yellow('‚ö†Ô∏è  ruler not found, skipping ruler init'));\n    console.log(pc.dim('   Install ruler: npm install -g @intellectronica/ruler'));\n  }\n\n  // Done\n  console.log(pc.bold(pc.green('\\n‚úÖ tkhrn-ruler initialized successfully!\\n')));\n  console.log(pc.dim('Next steps:'));\n  console.log(pc.dim('  1. Configure MCP tokens in .env.mcp.local'));\n  console.log(pc.dim('  2. Run \"tkhrn-ruler apply\" to apply rules'));\n  console.log('');\n}\n\nfunction runCommand(\n  command: string,\n  args: string[],\n  options: { silent?: boolean } = {}\n): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const child = spawn(command, args, {\n      stdio: options.silent ? 'ignore' : 'inherit',\n      shell: true,\n    });\n\n    child.on('error', reject);\n    child.on('close', (code) => {\n      if (code === 0) {\n        resolve();\n      } else {\n        reject(new Error(`Command failed with code ${code}`));\n      }\n    });\n  });\n}\n\nfunction updateGitignore(cwd: string) {\n  const gitignorePath = join(cwd, '.gitignore');\n  const additions = `\n# Agent Handover Context\n.handover/\n\n# MCP tokens\n.env.mcp.local\n`;\n\n  if (existsSync(gitignorePath)) {\n    const content = readFileSync(gitignorePath, 'utf-8');\n\n    if (!content.includes('.handover/')) {\n      appendFileSync(gitignorePath, additions);\n      console.log(pc.green('‚úì .gitignore updated'));\n    } else {\n      console.log(pc.dim('  .gitignore already configured'));\n    }\n  } else {\n    writeFileSync(gitignorePath, additions.trim() + '\\n');\n    console.log(pc.green('‚úì .gitignore created'));\n  }\n}\n\nasync function createEnvTemplate(cwd: string) {\n  const template = `# MCP Server Tokens\n# Copy this file to .env.mcp.local and add your tokens\n\n# Figma - Design token extraction\nFIGMA_ACCESS_TOKEN=\n\n# Notion - Documentation access\nNOTION_API_KEY=\n`;\n\n  writeFileSync(join(cwd, '.env.mcp.example'), template);\n  console.log(pc.green('‚úì .env.mcp.example created'));\n}\n","// tkhrn-ruler - Frontend common ruleset for AI agents\n// Main entry point for programmatic usage\n\nexport const VERSION = '0.1.0';\nexport const REPO = 'ginameee/tkhrn-ruler';\n"],"mappings":"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","names":["spawn","pc","pc","spawn"]}